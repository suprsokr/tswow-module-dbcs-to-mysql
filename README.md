# tswow-module-dbcs-to-mysql

Bulk export TSWoW module's source and dest DBC files to a MySQL database.

Rather than being a part of development workflow (like https://github.com/stoneharry/DBC-Editing-Workflow), this is to enable AI to better understand DBC structure so that the AI can then return back to TSWoW tools for creating spells in Livescripts and Datascripts. This tool also works well with TSWoW's module structure.

## Quick Start - Bulk Export to MySQL

### 1. Compile TSWoW from source

Follow the official guide: https://tswow.github.io/tswow-wiki/install/compiling

### 2. Use git to clone this repository

### 3. Install dependencies

```bash
npm install
```

### 4. Configure settings

Copy the example config and update with your settings:

```bash
cp config.example.json config.json
# Edit config.json with your MySQL credentials and default module
```

**config.json:**
```json
{
  "mysql": {
    "host": "localhost",
    "port": 3306,
    "user": "tswow",
    "password": "password"
  },
  "module": "default",
  "tswowInstallPath": "c:\\wowdev\\tswow-install",
  "tswowSourcePath": "c:\\wowdev\\tswow"
}
```

**Notes:**
- MySQL user needs CREATE, DROP, INSERT, and SELECT permissions
- `module` can be **any parent module** as defined in [TSWoW Modules documentation](https://tswow.github.io/tswow-wiki/documentation/modules.html)
  - Examples: "default"
  - Assumption: All parent modules have the same internal structure: `modules/{name}/datasets/dataset/dbc/` and `dbc_source/`

### 5. Generate schemas from TSWoW (one-time)

```bash
node parse-tswow-schemas.js
```

This reads all TSWoW DBC definitions and creates `dbc-schemas.json` with proper field names and types for all 246 DBCs.

### 6. Export DBCs to MySQL

```bash
# Export from default module (both dbc and dbc_source)
node export-module-dbc.js

# Export only post-TSWoW DBCs
node export-module-dbc.js --source dbc

# Export only original Blizzard DBCs
node export-module-dbc.js --source dbc_source

# Export from ANY module (just use the module name)
node export-module-dbc.js --module my-custom-module

# Export just specific entry IDs (great for testing custom spells/items)
node export-module-dbc.js --dbc Spell --ids 80902,133,1449

# Export just one DBC with record limit
node export-module-dbc.js --dbc Spell --limit 100

# Dry run to see what would happen
node export-module-dbc.js --dry-run
```

This will create the `dbc` and `dbc_source` databases and import all 246 DBC files as tables with **proper column names**!

**Tip:** Use `--ids` to quickly export and verify your custom entries without re-exporting the entire DBC!

## Command Line Options

```bash
node export-module-dbc.js [options]
```

**Options:**
- `--module NAME` - Module name (uses `module` from config.json if not specified)
- `--source TYPE` - Export `dbc`, `dbc_source`, or `both` (default: both)
- `--dbc NAME` - Export only this DBC file
- `--ids ID,ID,...` - Export only specific entry IDs (comma-separated)
- `--limit N` - Limit number of records per DBC
- `--dry-run` - Show what would be done without doing it
- `--help` - Show help message

**Examples:**
```bash
# Export everything from default module
node export-module-dbc.js

# Export only your custom spell (e.g., ID 80902)
node export-module-dbc.js --dbc Spell --ids 80902

# Export multiple specific spells to compare
node export-module-dbc.js --dbc Spell --ids 80902,133,1449,5143

# Export from a custom module
node export-module-dbc.js --module cow-level --source dbc

# Test run before committing
node export-module-dbc.js --dbc Spell --dry-run
```

## How TSWoW DBCs Work

When TSWoW builds datascripts (`build data`), it:
1. Reads from `modules/{module}/datasets/dataset/dbc_source/` (original Blizzard DBCs)
2. Applies your datascript modifications (e.g., `std.Spells.create()`)
3. Writes to `modules/{module}/datasets/dataset/dbc/` (modified DBCs)

This tool exports **both** folders to separate MySQL databases:
- `dbc_source` database ← Original Blizzard data
- `dbc` database ← Your modified data (post-datascripts)

See `HOW_IT_WORKS.md` for detailed explanation of the TSWoW build process.

### How the Exporter Works

The export-module-dbc.js script:
1. Reads DBC schemas from `dbc-schemas.json` (generated by `parse-tswow-schemas.js`)
2. Parses binary DBC files using proper field offsets and types
3. Creates MySQL tables with proper column names (not `field_0`, `field_1`)
4. Expands array fields into separate columns (e.g., `Reagent_1`, `Reagent_2`)
5. Handles all DBC field types: INT, FLOAT, BIGINT, TINYINT, TEXT
6. Inserts records in batches for performance
7. Creates primary key on `ID` field

**Table naming:** DBC names are sanitized (e.g., `Achievement_Category.dbc` → `achievement_category` table)

## DBC File Format

```
Header (20 bytes):
- "WDBC" magic (4 bytes)
- Record count (4 bytes, int32)
- Field count (4 bytes, uint32)
- Record size (4 bytes, int32)
- String size (4 bytes, int32)

Data:
- Record data (recordCount * recordSize bytes)
- String table (stringSize bytes, null-terminated strings)
```

## Files

- `parse-tswow-schemas.js` - Extract field schemas from TSWoW TypeScript definitions
- `read-dbc-schema.js` - Read DBC files as JSON with proper field names
- `export-module-dbc.js` - Export DBCs to MySQL (both dbc and dbc_source)
- `dbc-schemas.json` - Generated schema definitions for all 246 DBCs
- `config.json` - MySQL credentials and default module